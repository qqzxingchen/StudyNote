# 乐观锁-悲观锁-共享锁-排他锁

## 悲观锁
    
* 认为写操作一定会造成数据不一致的情况，因此执行流程为： 加锁 -> 读 -> 计算 -> 写 -> 解锁
* 共享锁和排他锁都是悲观锁的一种实现

## 乐观锁
    
* 认为写操作大概率情况下不会造成数据不一致的情况

* 实现方式
    * 数据库存储数据时，除了储存值本身，还会存储一个版本号 version
    * 当读取数据时，除了读取值，还要读取该值的当前版本号
    * 计算数据
    * 在写入数据时，重新从数据库中读取该值以及对应的版本号
        * 如果发现版本号与最初读取得到的版本号一致，则写入成功，并更新数据库中的版本号，以 原版本号+1 作为新值
        * 如果发现版本号与最初读取得到的版本号不一致，则本次写入失败；进行重试

* 乐观锁适用于多读少写的场景

## 读写锁 -- ReentrantReadWriteLock

* 一个 Lock ，两个线程队列，分别为 read 线程队列以及 write 线程队列

* 步骤：
    * 任意线程申请锁时，先进行阻塞，然后按照 read 还是 write 放到相应的队列中
    * 此时 read 线程队列和 write 线程队列中的线程全被阻塞且 read 线程队列中的第一个线程与 write 线程队列中的第一个线程都有可能被唤醒
        * 如果 read 线程被唤醒，则 read 线程队列中的线程将会被依次唤醒
        * 如果 write 线程被唤醒，则只执行该 write 线程，其他线程都继续等待
    * 如此，即可实现 “读读不互斥” “读写互斥” “写写互斥”
